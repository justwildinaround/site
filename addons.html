<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#070a10" />
  <title>Add-ons — Detail’N Co.</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="bg bg--dither" aria-hidden="true"></div>

  <header class="nav">
    <div class="container nav__inner">
      <a class="brand" href="index.html" aria-label="Home">
        <img class="brand__logo" src="assets/logo.png" alt="Detail’N Co. logo" onerror="this.style.display='none'">
        <div class="brand__stack">
          <div class="brand__name">DETAIL’N CO.</div>
          <div class="brand__tag">Mobile Auto Detailing</div>
        </div>
      </a>

      <nav class="nav__links" aria-label="Primary">
        <a href="packages.html">Packages</a>
        <a href="addons.html" aria-current="page">Add-ons</a>
        <a href="payments.html">Payments</a>
        <a href="service-area.html">Service Area</a>
        <a href="testimonials.html">Reviews</a>
        <a href="booking.html">Book</a>
        <a href="contact.html">Contact</a>
      </nav>

      <button class="nav__toggle" id="navToggle" aria-label="Open menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div class="nav__mobile" id="navMobile" aria-hidden="true">
      <a href="packages.html">Packages</a>
      <a href="addons.html">Add-ons</a>
      <a href="payments.html">Payments</a>
      <a href="service-area.html">Service Area</a>
      <a href="testimonials.html">Reviews</a>
        <a href="booking.html">Book</a>
        <a href="contact.html">Contact</a>
      <a class="btn btn--ghost" href="https://instagram.com/detail.n.co" target="_blank" rel="noreferrer">Instagram</a>
    </div>
  </header>

  <main>
    <section class="section" style="padding-top:42px;">
      <div class="container">
        <div class="head">
          <div class="kicker">Add-ons</div>
          <h2>Optional services you can add to your booking.</h2>
          <p>Fixed-price add-ons can be paid online. “Starting at” items are quoted after inspection.</p>
        </div>

        <!-- CHECKOUT SUMMARY -->
        <div class="grid" style="grid-template-columns:1fr 1fr; margin-top:14px;">
          <div class="box">
            <div class="kicker" style="margin-bottom:10px;">Selected Package</div>
            <div style="font-weight:900; font-size:18px;" id="pkgName">—</div>
            <div class="muted" style="margin-top:6px;" id="pkgSize">—</div>
            <div class="price" style="margin-top:14px;">
              <div class="price__row"><span>Base price</span><strong id="pkgPrice">$0.00</strong></div>
              <div class="price__row"><span>Add-ons</span><strong id="addonsPrice">$0.00</strong></div>
              <div class="price__row"><span>Total</span><strong id="totalPrice">$0.00</strong></div>
            </div>
            <div class="fine" style="margin-top:12px;">
              Need to change package/size? <a href="packages.html" style="text-decoration:underline;">Go back</a>
            </div>
          </div>

          <div class="box box--note">
            <div class="kicker" style="margin-bottom:10px;">Pay Online</div>
            <p class="muted" style="margin:0 0 14px; line-height:1.6;">
              Secure checkout with card (debit/credit) or PayPal. You’ll receive a confirmation after payment.
            </p>

            <div class="cta__actions" style="margin:0;">
              <button class="btn btn--primary btn--full" id="payCardBtn" disabled>Pay by Card</button>
              <button class="btn btn--ghost btn--full" id="payPaypalBtn" disabled>Pay with PayPal</button>
            </div>

            <div class="fine" id="payHint" style="margin-top:12px;">
              Select any fixed-price add-ons (optional) to continue.
            </div>
          </div>
        </div>

        <!-- ADD-ONS CARDS -->
        <div class="cards cards--3" style="margin-top:16px;">
          <!-- Interior & Comfort -->
          <article class="card">
            <div class="card__head">
              <div class="tag tag--blue">INTERIOR &amp; COMFORT</div>
              <div class="card__title">Cabin Upgrade Add-ons</div>
              <div class="card__desc">Freshness, odor removal, and deeper interior restoration.</div>
            </div>

            <div class="addonList">
              <!-- Fixed-price (selectable) -->
              <label class="addonItem js-addon" data-key="interior_rescent" data-amount="25">
                <div class="addonItem__name">Interior Re-Scent (up to 1-month freshness)</div>
                <div class="addonItem__price">$25 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">A clean, refreshed cabin finish. Longevity varies by usage and environment.</div>
              </label>

              <label class="addonItem js-addon" data-key="smoke_odor" data-amount="60">
                <div class="addonItem__name">Smoke Odor Removal</div>
                <div class="addonItem__price">$60 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Long-lasting odor treatment. Severity and source may affect results.</div>
              </label>

              <!-- Quote-only (not selectable) -->
              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Seat Steam Cleaning</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Starting at $80. Quoted based on seat material, size, staining, and overall condition.</div>
              </div>

              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Leather Treatment</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Starting at $50. Cleaning, conditioning, and protection. Quoted by condition and interior size.</div>
              </div>

              <label class="addonItem js-addon" data-key="cabin_filter_clean" data-amount="5">
                <div class="addonItem__name">Cabin Air Filter Cleaning</div>
                <div class="addonItem__price">$5 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Light clean-out when accessible. Replacement not included.</div>
              </label>

              <label class="addonItem js-addon" data-key="engine_filter_clean" data-amount="10">
                <div class="addonItem__name">Engine Air Filter Cleaning</div>
                <div class="addonItem__price">$10 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Light clean-out when accessible. Replacement not included.</div>
              </label>
            </div>

            <div class="card__foot">
              <div class="fine">Quoted items are confirmed before work begins.</div>
            </div>
          </article>

          <!-- Exterior & Visual -->
          <article class="card card--featured">
            <div class="card__head">
              <div class="tag tag--red">EXTERIOR &amp; VISUAL</div>
              <div class="card__title">Finish &amp; Detail Add-ons</div>
              <div class="card__desc">Visibility, gloss, and targeted exterior improvement.</div>
            </div>

            <div class="addonList">
              <label class="addonItem js-addon" data-key="windshield_wax" data-amount="20">
                <div class="addonItem__name">Windshield Waxing &amp; Window Cleaning</div>
                <div class="addonItem__price">$20 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Hydrophobic windshield finish + clean glass clarity.</div>
              </label>

              <label class="addonItem js-addon" data-key="bug_tar" data-amount="30">
                <div class="addonItem__name">Bug &amp; Tar Removal</div>
                <div class="addonItem__price">$30 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Targeted treatment for front end / lower panels. Results vary by baked-on severity.</div>
              </label>

              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Chrome Shining / Polish</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Small $40 • Med $48 • Large $54 (size-based). Restores clarity and shine. Deep pitting may remain.</div>
              </div>

              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Rim Paint Touch-up (Gloss Black Only)</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Starting at $40. Quoted after inspection based on severity and rim count.</div>
              </div>

              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Minor Scuff Removal</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Starting at $20. Quoted after inspection. Results vary by depth and paint condition.</div>
              </div>
            </div>

            <div class="card__foot">
              <div class="fine">Size/condition items are quoted to avoid surprises.</div>
            </div>
          </article>

          <!-- Mechanical & Utility -->
          <article class="card">
            <div class="card__head">
              <div class="tag tag--blue">MECHANICAL &amp; UTILITY</div>
              <div class="card__title">Practical Add-ons</div>
              <div class="card__desc">Quick convenience services that help keep you rolling.</div>
            </div>

            <div class="addonList">
              <label class="addonItem js-addon" data-key="tire_air" data-amount="5">
                <div class="addonItem__name">Tire Air Top-up</div>
                <div class="addonItem__price">$5 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Quick pressure top-up. Sensor resets not included.</div>
              </label>

              <div class="addonItem" data-quote="1">
                <div class="addonItem__name">Nail Removal &amp; Tire Repair</div>
                <div class="addonItem__price">Quoted</div>
                <div class="addonItem__note">Starting at $40. Repairability depends on puncture location and tire condition.</div>
              </div>

              <label class="addonItem js-addon" data-key="engine_bay_clean" data-amount="50">
                <div class="addonItem__name">Engine Bay Cleaning</div>
                <div class="addonItem__price">$50 <input type="checkbox" style="margin-left:10px;"></div>
                <div class="addonItem__note">Careful surface clean. Not a deep degrease unless quoted separately.</div>
              </label>
            </div>

            <div class="card__foot">
              <div class="fine">Safety-first assessment on all utility work.</div>
            </div>
          </article>
        </div>

        <div class="notice">
          <div class="notice__bar"></div>
          <div class="notice__text">
            <strong>Add-ons are always optional.</strong>
            Quoted services are confirmed with you before work begins.
          </div>
        </div>

        <footer class="footer">
          <a class="footerBrand" href="index.html" aria-label="Home">
            <img class="footerBrand__logo" src="assets/logo.png" alt="Detail’N Co. logo" onerror="this.style.display='none'">
            <div class="footerBrand__stack">
              <div class="footerBrand__name">DETAIL’N CO.</div>
              <div class="footerBrand__tag">Mobile Auto Detailing</div>
            </div>
          </a>

          <div class="footerLinks">
            <a href="packages.html">Packages</a>
            <a href="payments.html">Payments</a>
            <a href="service-area.html">Service Area</a>
        <a href="booking.html">Book</a>
        <a href="contact.html">Contact</a>
          </div>
        </footer>
      </div>
    </section>
  </main>

  <script src="app.js"></script>

  <!-- Add-ons checkout logic -->
  <script>
    // Package pricing by size (CAD) — mirrors packages.html
    const PACKAGE_PRICING = {
      select:    { name: "Select — Refresh & Shine",    small: 89.99,  medium: 109.99, large: 124.99 },
      signature: { name: "Signature — Enhanced Detail", small: 134.99, medium: 164.99, large: 182.99 },
      showroom:  { name: "Showroom — Ultimate Revitalization", small: 249.99, medium: 299.99, large: 339.99 },
    };

    const fmt = (n) => `$${n.toFixed(2)} CAD`;

    const pkgKey = localStorage.getItem("dnco_package");
    const sizeKey = localStorage.getItem("dnco_size");

    if (!pkgKey || !sizeKey || !PACKAGE_PRICING[pkgKey] || !(sizeKey in PACKAGE_PRICING[pkgKey])) {
      // If someone lands here directly, send them back to pick package
      window.location.href = "packages.html";
    }

    const pkg = PACKAGE_PRICING[pkgKey];
    const base = pkg[sizeKey];

    const pkgNameEl = document.getElementById("pkgName");
    const pkgSizeEl = document.getElementById("pkgSize");
    const pkgPriceEl = document.getElementById("pkgPrice");
    const addonsPriceEl = document.getElementById("addonsPrice");
    const totalPriceEl = document.getElementById("totalPrice");
    const payHintEl = document.getElementById("payHint");
    const payCardBtn = document.getElementById("payCardBtn");
    const payPaypalBtn = document.getElementById("payPaypalBtn");

    pkgNameEl.textContent = pkg.name;
    pkgSizeEl.textContent = `Vehicle size: ${sizeKey.toUpperCase()}`;
    pkgPriceEl.textContent = fmt(base);

    function getSelectedAddons() {
      const list = [];
      document.querySelectorAll(".js-addon input[type='checkbox']").forEach((cb) => {
        if (!cb.checked) return;
        const wrap = cb.closest(".js-addon");
        const key = wrap?.dataset?.key;
        const amount = Number(wrap?.dataset?.amount || 0);
        if (key && amount > 0) list.push({ key, amount });
      });
      return list;
    }

    function recalc() {
      const addons = getSelectedAddons();
      const addonsTotal = addons.reduce((s, a) => s + a.amount, 0);
      const total = base + addonsTotal;

      addonsPriceEl.textContent = fmt(addonsTotal);
      totalPriceEl.textContent = fmt(total);

      // Enable checkout even with no add-ons (base package is already selected)
      payCardBtn.disabled = false;
      payPaypalBtn.disabled = false;

      payHintEl.textContent = "Ready — checkout opens securely in a new page.";
    }

    document.addEventListener("change", (e) => {
      if (e.target && e.target.matches(".js-addon input[type='checkbox']")) recalc();
    });

    recalc();

    async function postJSON(url, body) {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    // Stripe
    payCardBtn.addEventListener("click", async () => {
      const addons = getSelectedAddons().map(a => a.key);

      // Save selection (useful for thank-you pages)
      localStorage.setItem("dnco_addons", JSON.stringify(addons));

      const { url } = await postJSON("/api/stripe/checkout", {
        packageKey: pkgKey,
        sizeKey: sizeKey,
        addonKeys: addons
      });

      window.location.href = url;
    });

    // PayPal
    payPaypalBtn.addEventListener("click", async () => {
      const addons = getSelectedAddons().map(a => a.key);
      localStorage.setItem("dnco_addons", JSON.stringify(addons));

      const { approveUrl } = await postJSON("/api/paypal/create-order", {
        packageKey: pkgKey,
        sizeKey: sizeKey,
        addonKeys: addons
      });

      window.location.href = approveUrl;
    });
  </script>
</body>
</html>
